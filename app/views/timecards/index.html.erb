<% provide(:title, '勤怠入力') %>
<h1><%= @b_date.year %>年<%= @b_date.month %>月　勤怠</h1>

<% prev_month = @b_date.prev_month %>
<% next_month = @b_date.next_month %>

<div class="center">
  <span class = "btn-group">
    <% (-6..6).each do |i| %>
      <% mon = @b_date.months_since(i) %>
      <% if i == 0 %>
        <%= link_to mon.to_s(:y_slash_m), timecards_path(year: mon.year, month: mon.month),
                                        class: "btn btn-default active" %>
      <% else %>
        <%= link_to mon.to_s(:y_slash_m), timecards_path(year: mon.year, month: mon.month),
                                        class: "btn btn-default" %>
      <% end %>
    <% end %>
  </span>
</div>

<br>

<table class="table table-hover">
  <thead>
    <tr align="center">
      <th class="centerized">日付</th>
      <th class="centerized">勤怠</th>
      <th class="centerized">業務開始時刻</th>
      <th class="centerized">業務終了時刻</th>
      <th class="centerized">休憩開始時刻</th>
      <th class="centerized">休憩終了時刻</th>
      <th class="centerized">記入済</th>
    </tr>
  </thead>

  <tbody>
    <% @monthly_timecards.each do |tc| %>
      <% if tc.is_new %>
        <tr data-link="<%= new_timecard_path(biz_date: tc.biz_date) %>" style="cursor: pointer;">
      <% else %>
        <tr data-link="<%= edit_timecard_path(tc) %>" style="cursor: pointer;">
      <% end %>
        <td class="centerized"><%= tc.biz_date.to_s(:y_slash_m_slash_d) %></td>
        <td class="centerized"><%= @attn_ctgrs.find_by(val: tc.attn_ctgr).name %></td>
        <td class="centerized"><%= tc.work_start_time.to_s(:h_colon_m) %></td>
        <td class="centerized"><%= tc.work_end_time.to_s(:h_colon_m) %></td>
        <td class="centerized"><%= tc.rest_start_time.to_s(:h_colon_m) %></td>
        <td class="centerized"><%= tc.rest_end_time.to_s(:h_colon_m) %></td>
	<% if tc.is_new %>
          <td class="centerized"></td>
	<% else %>
          <td class="centerized"><span class="glyphicon glyphicon-ok"></span></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<script>
  $("tr[data-link]").click(function() {
    window.location = $(this).data("link")
  })
</script>
